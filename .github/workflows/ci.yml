name: CI
on:
  pull_request:
    branches:
      - master
      - 'release/**'
      - 'next'
      - 'beta'
      - 'alpha'
      - 'rc'

permissions:
  contents: read

jobs:
  ci:
    runs-on: ubuntu-latest
    env:
      CI: true
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup
        uses: actions/setup-node@v4
        with:
          node-version: '24'
          cache: 'npm'
      - name: Install
        run: npm install
      - name: Rebuild native dependencies
        run: |
          npm rebuild @swc/core
          npm install --force @swc/core-linux-x64-gnu @swc/core-linux-x64-musl
      - name: Verify SWC installation
        run: |
          node -e "try { require('@swc/core'); console.log('SWC loaded successfully'); } catch(e) { console.error('SWC failed to load:', e.message); process.exit(1); }"
      - name: Playwright install
        run: npx playwright install --with-deps
      - name: Lint
        run: npm run lint
      - name: Build library
        run: npm run build:lib
      - name: Test
        run: npm run test:ci
      - name: Integration test
        run: npm run storybook:test
      - name: E2E tests
        run: npx playwright test --project=chromium
        env:
          CI: true
      - name: Build examples app
        run: npm run build:app
